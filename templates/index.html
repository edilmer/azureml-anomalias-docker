<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Detección de Anomalías (Azure ML)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:18px}
    .card{max-width:1200px;margin:auto;border:1px solid #ddd;padding:18px;border-radius:12px}
    .row{display:flex;gap:14px;flex-wrap:wrap}
    .col{flex:1 1 560px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #999;background:#0a7;color:#fff;text-decoration:none}
    .btn.secondary{background:#555}
    input[type=file],input[type=text]{padding:8px}
    .tbl{border-collapse:collapse;width:100%}
    .tbl td,.tbl th{border:1px solid #ddd;padding:6px}
    .tbl th{background:#f2f2f2}
    .err{color:#b00020;font-weight:600}
  </style>
</head>
<body>
  <div class="card">
    <h2>Detección de Anomalías (Azure ML)</h2>

    <form method="post" enctype="multipart/form-data">
      <p>
        <label>Archivo (.csv / .xlsx / .data): </label>
        <input type="file" name="file" required />
      </p>
      <p>
        <label>Etiqueta de sitio (opcional): </label>
        <input type="text" name="site_label" placeholder="103" />
      </p>
      <p><button class="btn" type="submit">Procesar y graficar</button></p>
    </form>

    {% if error %}
      <p class="err">{{ error }}</p>
    {% endif %}

    {% if img_full %}
      <h3>Serie completa</h3>
      <div class="row">
        <div class="col">
          <img src="{{ img_full }}" style="width:100%;max-width:100%" />
        </div>
        <div class="col">
          <h3>Zoom automático (±15 días)</h3>
          <img src="{{ img_zoom }}" style="width:100%;max-width:100%" />
        </div>
      </div>

      <p style="margin-top:12px">
        <a class="btn" href="{{ url_for('download_xlsx') }}">⬇️ Descargar anomalías (Excel)</a>
        <a class="btn secondary" href="{{ url_for('download_pdf') }}">⬇️ Descargar anomalías (PDF)</a>
        {% if anomalies_count is not none %}
          <span style="margin-left:10px;color:#444">Total anomalías: <b>{{ anomalies_count }}</b></span>
        {% endif %}
      </p>

      <h3>Vista previa de datos (primeras 50 filas)</h3>
      {{ rows_preview|safe }}
    {% endif %}
  </div>
</body>
</html>
